<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Inteligente</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f8fa;
      color: #2c3e50;
      padding: 40px;
      max-width: 800px;
      margin: auto;
    }
    h1 {
      color: #34495e;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
    }
    button {
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #27ae60;
    }
    .resultado {
      background: #ffffff;
      margin-top: 25px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .error {
      color: red;
      font-weight: bold;
    }
    #grafica {
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1>ü§ñ Calculadora Inteligente</h1>
<p>Ejemplos: <code>2x+3=7</code> ‚Äî <code>x^2 - 4 &gt; 0</code> ‚Äî <code>y=2/(x-1)</code> ‚Äî <code>log(x)+3</code> ‚Äî <code>‚àö(x+2)</code></p>

<input type="text" id="entrada" placeholder="Escribe una funci√≥n, ecuaci√≥n o desigualdad">
<button onclick="resolver()">Resolver</button>

<div class="resultado" id="resultado"></div>
<div id="grafica"></div>

<script>
function decir(texto) {
  const voz = new SpeechSynthesisUtterance(texto);
  voz.lang = "es-ES";
  speechSynthesis.speak(voz);
}

function mostrarAsintotasVerticales(exprFn, xRange = [-20, 20]) {
  const asintotas = [];
  for (let i = xRange[0]; i <= xRange[1]; i += 0.1) {
    try {
      let y = exprFn(i);
      if (!isFinite(y)) asintotas.push(parseFloat(i.toFixed(2)));
    } catch {
      asintotas.push(parseFloat(i.toFixed(2)));
    }
  }
  return [...new Set(asintotas)];
}

function graficar(expr, label = "f(x)") {
  const safeExpr = expr
    .replace(/x\^2/g, "Math.pow(x,2)")
    .replace(/‚àö\(/g, "Math.sqrt(")
    .replace(/log\(/g, "Math.log10(")
    .replace(/ln\(/g, "Math.log(");

  try {
    const f = new Function("x", "return " + safeExpr);
    const x = [], y = [];
    for (let i = -20; i <= 20; i += 0.1) {
      x.push(i);
      try { y.push(f(i)); } catch { y.push(null); }
    }

    const data = [{
      x, y,
      mode: "lines",
      name: label,
      line: { color: "#2980b9" }
    }];

    const asintotas = mostrarAsintotasVerticales(f);
    asintotas.forEach(val => {
      data.push({
        x: [val, val],
        y: [-20, 20],
        mode: "lines",
        name: `As√≠ntota x = ${val}`,
        line: { dash: "dot", color: "#e74c3c" }
      });
    });

    Plotly.newPlot("grafica", data, {
      title: "Gr√°fica de la funci√≥n",
      xaxis: { title: "x" },
      yaxis: { title: "f(x)" }
    });

    return asintotas;

  } catch (e) {
    console.error("Error al graficar:", e);
    return [];
  }
}

function resolver() {
  const entrada = document.getElementById("entrada").value.trim();
  const resultado = document.getElementById("resultado");
  resultado.innerHTML = "";
  Plotly.purge("grafica");

  try {
    let mensaje = "";
    if (/y\s*=\s*/.test(entrada)) {
      const expr = entrada.split("=")[1];
      const asintotas = graficar(expr, entrada);
      mensaje = `Se ha graficado la funci√≥n ${entrada}.`;
      if (asintotas.length > 0) {
        mensaje += ` As√≠ntotas verticales en: x = ${asintotas.join(", ")}`;
      }
    } else if (/=|<|>/.test(entrada)) {
      mensaje = `Resoluci√≥n de ecuaciones y desigualdades a√∫n en desarrollo visual.`;
    } else {
      const valor = eval(entrada);
      mensaje = `El resultado de la expresi√≥n es: ${valor}`;
    }
    resultado.innerHTML = `<p>ü§ñ ${mensaje}</p>`;
    decir(mensaje);
  } catch (e) {
    resultado.innerHTML = `<p class="error">‚ùå Ingresa una funci√≥n v√°lida como y = 2/(x-2)</p>`;
    decir("Hubo un error al procesar tu funci√≥n");
  }
}
</script>

</body>
</html>
