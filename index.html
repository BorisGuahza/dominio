<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Inteligente</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f8fa;
      padding: 40px;
      max-width: 900px;
      margin: auto;
      color: #2c3e50;
    }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
    }
    button {
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #27ae60;
    }
    .resultado {
      margin-top: 25px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .error { color: red; font-weight: bold; }
    #grafica { margin-top: 40px; }
  </style>
</head>
<body>

<h1>ü§ñ Calculadora Inteligente</h1>
<p>Ingresa una expresi√≥n como:<br>
<code>y=2/(x-2)</code>, <code>y=Math.log(x)</code>, <code>y=x^2</code></p>

<input type="text" id="input" placeholder="Escribe tu funci√≥n (ej. y=2/(x-2))">
<button onclick="procesarEntrada()">Resolver</button>

<div class="resultado" id="salida"></div>
<div id="grafica"></div>

<script>
  function decir(texto) {
    const voz = new SpeechSynthesisUtterance(texto);
    voz.lang = "es-ES";
    speechSynthesis.speak(voz);
  }

  function procesarEntrada() {
    const entrada = document.getElementById("input").value.trim();
    const salida = document.getElementById("salida");
    const expr = entrada.replace(/\^/g, "**").replace(/x¬≤/g, "x*x");

    Plotly.purge("grafica");
    salida.innerHTML = "";

    if (!entrada.toLowerCase().startsWith("y=")) {
      salida.innerHTML = `<div class="error">‚ùå Ingresa una funci√≥n v√°lida como y = 2/(x - 2)</div>`;
      decir("Debes escribir una funci√≥n como y igual a algo.");
      return;
    }

    const funcion = expr.split("=")[1];
    const f = new Function("x", `return ${funcion};`);
    const x = [], y = [], asintotas = new Set(), yEstimada = [];

    for (let i = -50; i <= 50; i += 0.2) {
      const xi = parseFloat(i.toFixed(3));
      try {
        const yi = f(xi);
        if (!isFinite(yi)) {
          y.push(null);
          asintotas.add(xi.toFixed(3));
        } else {
          x.push(xi);
          y.push(yi);
          yEstimada.push(yi);
        }
      } catch {
        y.push(null);
        asintotas.add(xi.toFixed(3));
      }
    }

    const trazos = [{
      x: x,
      y: y,
      mode: 'lines',
      name: `f(x)`,
      line: { color: '#3498db' }
    }];

    // Trazar as√≠ntotas detectadas autom√°ticamente
    asintotas.forEach(xa => {
      trazos.push({
        x: [xa, xa],
        y: [-100, 100],
        mode: 'lines',
        name: `As√≠ntota x = ${xa}`,
        line: { dash: 'dot', color: '#e74c3c' }
      });
    });

    const ymin = Math.min(...yEstimada).toFixed(2);
    const ymax = Math.max(...yEstimada).toFixed(2);
    const dominio = asintotas.size > 0 ? `x ‚àà ‚Ñù, excepto en: ${Array.from(asintotas).join(", ")}` : "x ‚àà ‚Ñù";
    const rango = `y ‚àà [${ymin}, ${ymax}] (estimado)`;

    Plotly.newPlot("grafica", trazos, {
      title: "Gr√°fica de la funci√≥n",
      xaxis: { title: "x", range: [-10, 10] },
      yaxis: { title: "f(x)", range: [-10, 10] }
    });

    const mensaje = `‚úÖ Funci√≥n graficada. Dominio: ${dominio}. Rango: ${rango}`;
    salida.innerHTML = `<div>${mensaje}</div>`;
    decir("La gr√°fica fue generada correctamente. Consulta el dominio y rango en pantalla.");
  }
</script>

</body>
</html>
