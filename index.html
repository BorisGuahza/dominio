<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora Todo en Uno</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f8fa;
      color: #2c3e50;
      padding: 40px;
      max-width: 800px;
      margin: auto;
    }
    h1 { color: #34495e; }
    input, button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
    }
    button {
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background-color: #27ae60; }
    .resultado {
      background: #ffffff;
      margin-top: 25px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .item { margin-bottom: 15px; }
    .error { color: red; font-weight: bold; }
    #grafica { margin-top: 30px; }
  </style>
</head>
<body>

<h1>ðŸ¤– Calculadora Todo en Uno</h1>
<p>Ejemplos: <code>2x + 3 = 7</code> â€” <code>xÂ² - 4 â‰¥ 0</code> â€” <code>1/(x - 2)</code> â€” <code>5 + 3 * 2</code></p>

<input type="text" id="entrada" placeholder="Escribe tu expresiÃ³n, ecuaciÃ³n o desigualdad">
<button onclick="resolver()">Resolver</button>

<div class="resultado" id="resultado"></div>
<div id="grafica"></div>

<script>
  function decir(texto) {
    const voz = new SpeechSynthesisUtterance(texto);
    voz.lang = "es-ES";
    speechSynthesis.speak(voz);
  }

  function hablaBot(tipo, datos) {
    switch (tipo) {
      case "expresionNumerica": return `Eso es solo una expresiÃ³n. El resultado es: ${datos}`;
      case "faltaOperador": return `Parece que olvidaste escribir un signo de igualdad o desigualdad.`;
      case "error": return `Ups... algo no saliÃ³ bien. Revisa tu expresiÃ³n.`;
      case "resolver": return `Resolviendo: ${datos}`;
      default: return datos;
    }
  }

  function graficar(expr) {
    const f = new Function("x", "return " + expr.replace(/xÂ²/g, "x*x").replace(/x\^2/g, "x*x"));
    const x = [], y = [], asintotas = [];

    for (let i = -20; i <= 20; i += 0.1) {
      x.push(i);
      try {
        const val = f(i);
        if (!isFinite(val)) {
          y.push(null);
          asintotas.push(i.toFixed(2));
        } else {
          y.push(val);
        }
      } catch {
        y.push(null);
        asintotas.push(i.toFixed(2));
      }
    }

    const trazos = [{
      x: x, y: y, mode: 'lines', name: 'f(x)', line: { color: '#2ecc71' }
    }];

    [...new Set(asintotas)].forEach(a => {
      trazos.push({
        x: [a, a],
        y: [-20, 20],
        mode: 'lines',
        name: `AsÃ­ntota x = ${a}`,
        line: { dash: 'dot', color: '#e74c3c' }
      });
    });

    Plotly.newPlot("grafica", trazos, {
      title: "GrÃ¡fica de la funciÃ³n",
      xaxis: { title: "x", range: [-10, 10] },
      yaxis: { title: "f(x)", range: [-10, 10] }
    });
  }

  function resolver() {
    const entrada = document.getElementById("entrada").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "";
    Plotly.purge("grafica");

    const desigualdadRegex = /(.+)(<=|>=|<|>)(.+)/;
    const igualdadRegex = /(.+)=([^=]+)/;

    try {
      if (desigualdadRegex.test(entrada)) {
        const match = entrada.match(desigualdadRegex);
        const izquierda = match[1], operador = match[2], derecha = match[3];
        const expr = `(${izquierda}) - (${derecha})`;
        graficar(expr);
        const mensaje = `Resolviendo la desigualdad ${entrada}`;
        resultado.innerHTML = `<div class="item">ðŸ¤– ${mensaje}</div>`;
        decir(mensaje);
      } else if (igualdadRegex.test(entrada)) {
        const match = entrada.match(igualdadRegex);
        const izquierda = match[1], derecha = match[2];
        const expr = `(${izquierda}) - (${derecha})`;
        graficar(expr);
        const mensaje = `Resolviendo la ecuaciÃ³n ${entrada}`;
        resultado.innerHTML = `<div class="item">ðŸ¤– ${mensaje}</div>`;
        decir(mensaje);
      } else {
        if (entrada.includes("x")) {
          const mensaje = hablaBot("faltaOperador");
          resultado.innerHTML = `<div class="item error">ðŸ¤– ${mensaje}</div>`;
          decir(mensaje);
        } else {
          const valor = eval(entrada);
          const mensaje = hablaBot("expresionNumerica", valor);
          resultado.innerHTML = `<div class="item">ðŸ¤– ${mensaje}</div>`;
          decir(mensaje);
          graficar(entrada);
        }
      }
    } catch (e) {
      const mensaje = hablaBot("error");
      resultado.innerHTML = `<div class="item error">ðŸ¤– ${mensaje}</div>`;
      decir(mensaje);
    }
  }
</script>

</body>
</html>
