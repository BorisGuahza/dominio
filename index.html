<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Ecuaciones y Desigualdades</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f8fa;
      color: #2c3e50;
      padding: 40px;
      max-width: 800px;
      margin: auto;
    }

    h1 {
      color: #34495e;
    }

    input, button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
      box-sizing: border-box;
    }

    button {
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #27ae60;
    }

    .resultado {
      background: #ffffff;
      margin-top: 25px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }

    .item {
      margin-bottom: 15px;
    }

    .error {
      color: red;
      font-weight: bold;
    }

    #grafica {
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1>ü§ñ Calculadora Inteligente</h1>
<p>Ejemplos:<br>
<code>2x + 3 = 7</code> ‚Äî 
<code>x¬≤ - 4 ‚â• 0</code> ‚Äî 
<code>5 + 3 * 2</code></p>

<input type="text" id="desigualdad" placeholder="Escribe tu ecuaci√≥n o desigualdad">
<button onclick="resolverDesigualdad()">Resolver</button>

<div class="resultado" id="resultado"></div>
<div id="grafica"></div>

<script>
  function decir(texto) {
    const voz = new SpeechSynthesisUtterance(texto);
    voz.lang = "es-ES";
    voz.pitch = 1;
    voz.rate = 1;
    voz.volume = 1;
    speechSynthesis.speak(voz);
  }

  function hablaBot(tipo, datos) {
    switch (tipo) {
      case "ecuacionLineal":
        return `¬°Listo! Resolviendo la ecuaci√≥n, obtengo que x vale ${datos}.`;
      case "ecuacionCuadratica":
        return `He resuelto tu ecuaci√≥n cuadr√°tica. Las soluciones son: x = ${datos[0]} y x = ${datos[1]}.`;
      case "ecuacionCuadraticaDoble":
        return `Esta ecuaci√≥n tiene una √∫nica soluci√≥n doble: x = ${datos}.`;
      case "ecuacionSinSol":
        return `Lo siento... esta ecuaci√≥n no tiene soluci√≥n real.`;
      case "desigualdadLineal":
        return `La soluci√≥n de tu desigualdad es: ${datos}`;
      case "desigualdadCuadratica":
        return `Resolviendo tu desigualdad cuadr√°tica, encontr√© que: ${datos}`;
      case "expresionNumerica":
        return `Eso es solo una expresi√≥n. El resultado es: ${datos}`;
      case "faltaOperador":
        return `Parece que olvidaste escribir un signo de igualdad o desigualdad.`;
      case "error":
        return `Ups... algo no sali√≥ bien. Revisa tu expresi√≥n.`;
      default:
        return `Hmm... no entend√≠ tu entrada. Int√©ntalo otra vez.`;
    }
  }

  function graficar(expr) {
    const f = new Function("x", `return ${expr.replace(/x¬≤/g, "x*x").replace(/x\\^2/g, "x*x")};`);
    const x = [], y = [];
    for (let i = -10; i <= 10; i += 0.1) {
      x.push(i);
      try { y.push(f(i)); } catch { y.push(null); }
    }
    Plotly.newPlot('grafica', [{
      x, y, mode: 'lines', name: 'f(x)', line: { color: '#2ecc71' }
    }], {
      title: 'Gr√°fica de la funci√≥n',
      xaxis: { title: 'x' },
      yaxis: { title: 'f(x)' }
    });
  }

  function resolverDesigualdad() {
    const entrada = document.getElementById("desigualdad").value.trim().replace(/\s+/g, "");
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "";
    Plotly.purge("grafica");

    const desigualdadRegex = /(.+)(<=|>=|<|>)(.+)/;
    const igualdadRegex = /(.+)=([^=]+)/;

    try {
      if (desigualdadRegex.test(entrada)) {
        const match = entrada.match(desigualdadRegex);
        const izquierda = match[1], operador = match[2], derecha = match[3];
        const expr = `(${izquierda}) - (${derecha})`;
        const cuadratica = expr.includes("x^2") || expr.includes("x*x") || expr.match(/x\*x|x¬≤/);
        cuadratica ? resolverCuadratica(expr, operador, resultado)
                   : resolverLineal(expr, operador, resultado);
        graficar(expr);
      } else if (igualdadRegex.test(entrada)) {
        const match = entrada.match(igualdadRegex);
        const izquierda = match[1], derecha = match[2];
        const expr = `(${izquierda}) - (${derecha})`;
        const cuadratica = expr.includes("x^2") || expr.includes("x*x") || expr.match(/x\*x|x¬≤/);
        cuadratica ? resolverEcuacionCuadratica(expr, resultado)
                   : resolverEcuacionLineal(expr, resultado);
        graficar(expr);
      } else {
        if (entrada.includes("x")) {
          const mensaje = hablaBot("faltaOperador");
          decir(mensaje);
          resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
        } else {
          const valor = eval(entrada);
          const mensaje = hablaBot("expresionNumerica", valor);
          decir(mensaje);
          resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
          Plotly.purge("grafica");
        }
      }
    } catch (e) {
      const mensaje = hablaBot("error");
      decir(mensaje);
      resultado.innerHTML = `<div class="item error">ü§ñ ${mensaje}</div>`;
      Plotly.purge("grafica");
    }
  }

  function resolverEcuacionLineal(expr, resultado) {
    const re = /([-+]?\d*\.?\d*)x/;
    const match = expr.match(re);
    const a = parseFloat(match[1] || (match[1] === "" ? 1 : 0));
    const b = eval(expr.replace(re, ""));
    let mensaje = (a === 0)
      ? (b === 0 ? hablaBot("ecuacionLineal", "x ‚àà ‚Ñù") : hablaBot("ecuacionSinSol"))
      : hablaBot("ecuacionLineal", -b / a);
    decir(mensaje);
    resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
  }

  function resolverEcuacionCuadratica(expr, resultado) {
    const f = new Function("x", `return ${expr.replace(/x¬≤/g, "x*x").replace(/x\\^2/g, "x*x")};`);
    const f0 = f(0), f1 = f(1), f_1 = f(-1);
    const a = f1 - 2*f0 + f_1, b = (f1 - f_1) / 2, c = f0;
    const D = b*b - 4*a*c;
    let mensaje = "";
    if (D < 0) mensaje = hablaBot("ecuacionSinSol");
    else if (D === 0) mensaje = hablaBot("ecuacionCuadraticaDoble", -b/(2*a));
    else mensaje = hablaBot("ecuacionCuadratica", [
      (-b + Math.sqrt(D)) / (2 * a),
      (-b - Math.sqrt(D)) / (2 * a)
    ]);
    decir(mensaje);
    resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
  }

  function resolverLineal(expr, operador, resultado) {
    const re = /([-+]?\d*\.?\d*)x/;
    const match = expr.match(re);
    const a = parseFloat(match[1] || (match[1] === "" ? 1 : 0));
    const b = eval(expr.replace(re, ""));
    let sol = "";
    if (a === 0) {
      sol = eval(`0 ${operador} ${b}`) ? "x ‚àà ‚Ñù" : "No hay soluci√≥n";
    } else {
      const x = -b / a;
      const signos = { "<": "x < ", "<=": "x ‚â§ ", ">": "x > ", ">=": "x ‚â• " };
      sol = `${signos[operador]}${x}`;
    }
    const mensaje = hablaBot("desigualdadLineal", sol);
    decir(mensaje);
    resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
  }

  function resolverCuadratica(expr, operador, resultado) {
    const f = new Function("x", `return ${expr.replace(/x¬≤/g, "x*x").replace(/x\\^2/g, "x*x")};`);
    const f0 = f(0), f1 = f(1), f_1 = f(-1);
    const a = f1 - 2*f0 + f_1, b = (f1 - f_1)/2, c = f0;
    const D = b*b - 4*a*c;
    let sol = "";
    if (D < 0) {
      sol = ((a > 0 && operador === ">") || (a < 0 && operador === "<")) ? "x ‚àà ‚Ñù" : "No hay soluci√≥n";
    } else if (D === 0) {
      const r = -b / (2 * a);
      sol = (operador === ">" || operador === "<") ? `x ‚àà ‚Ñù, x ‚â† ${r}` : `x = ${r}`;
    } else {
      const r1 = (-b + Math.sqrt(D)) / (2 * a);
      const r2 = (-b - Math.sqrt(D)) / (2 * a);
      const [min, max] = [Math.min(r1, r2), Math.max(r1, r2)];
      if (a > 0) {
        if (operador === ">") sol = `x < ${min} o x > ${max}`;
        if (operador === ">=") sol = `x ‚â§ ${min} o x ‚â• ${max}`;
        if (operador === "<") sol = `x ‚àà (${min}, ${max})`;
        if (operador === "<=") sol = `x ‚àà [${min}, ${max}]`;
      } else {
        if (operador === "<") sol = `x < ${min} o x > ${max}`;
        if (operador === "<=") sol = `x ‚â§ ${min} o x ‚â• ${max}`;
        if (operador === ">") sol = `x ‚àà (${min}, ${max})`;
        if (operador === ">=") sol = `x ‚àà [${min}, ${max}]`;
      }
    }
    const mensaje = hablaBot("desigualdadCuadratica", sol);
    decir(mensaje);
    resultado.innerHTML = `<div class="item">ü§ñ ${mensaje}</div>`;
  }
</script>

</body>
</html>
